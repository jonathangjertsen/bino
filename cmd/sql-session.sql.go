// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: sql-session.sql

package main

import (
	"context"

	"github.com/jackc/pgx/v5/pgconn"
	"github.com/jackc/pgx/v5/pgtype"
)

const deleteStaleSessions = `-- name: DeleteStaleSessions :execresult
DELETE FROM session
WHERE expires < NOW()
  -- Try to make sure users log in at the start of a session rather than the middle of it 
  OR (
    (expires < NOW() + INTERVAL '20 minutes')
    AND last_seen < NOW() - INTERVAL '5 minutes'
  )
`

func (q *Queries) DeleteStaleSessions(ctx context.Context) (pgconn.CommandTag, error) {
	return q.db.Exec(ctx, deleteStaleSessions)
}

const getSession = `-- name: GetSession :one
SELECT id, appuser_id, expires, last_seen
FROM session
WHERE id = $1
`

func (q *Queries) GetSession(ctx context.Context, id string) (Session, error) {
	row := q.db.QueryRow(ctx, getSession, id)
	var i Session
	err := row.Scan(
		&i.ID,
		&i.AppuserID,
		&i.Expires,
		&i.LastSeen,
	)
	return i, err
}

const insertSession = `-- name: InsertSession :exec
INSERT INTO session (id, appuser_id, expires, last_seen)
VALUES ($1, $2, $3, NOW())
`

type InsertSessionParams struct {
	ID        string
	AppuserID int32
	Expires   pgtype.Timestamptz
}

func (q *Queries) InsertSession(ctx context.Context, arg InsertSessionParams) error {
	_, err := q.db.Exec(ctx, insertSession, arg.ID, arg.AppuserID, arg.Expires)
	return err
}

const revokeAllOtherSessionsForUser = `-- name: RevokeAllOtherSessionsForUser :execresult
DELETE FROM session
WHERE id != $1
  AND appuser_id == $2
`

type RevokeAllOtherSessionsForUserParams struct {
	ID        string
	AppuserID int32
}

func (q *Queries) RevokeAllOtherSessionsForUser(ctx context.Context, arg RevokeAllOtherSessionsForUserParams) (pgconn.CommandTag, error) {
	return q.db.Exec(ctx, revokeAllOtherSessionsForUser, arg.ID, arg.AppuserID)
}

const revokeAllSessionsForUser = `-- name: RevokeAllSessionsForUser :execresult
DELETE FROM session
WHERE appuser_id = $1
`

func (q *Queries) RevokeAllSessionsForUser(ctx context.Context, appuserID int32) (pgconn.CommandTag, error) {
	return q.db.Exec(ctx, revokeAllSessionsForUser, appuserID)
}

const revokeSession = `-- name: RevokeSession :exec
DELETE FROM session
WHERE id = $1
`

func (q *Queries) RevokeSession(ctx context.Context, id string) error {
	_, err := q.db.Exec(ctx, revokeSession, id)
	return err
}

const updateSessionLastSeen = `-- name: UpdateSessionLastSeen :exec
UPDATE session
SET last_seen = NOW()
WHERE id = $1
`

func (q *Queries) UpdateSessionLastSeen(ctx context.Context, id string) error {
	_, err := q.db.Exec(ctx, updateSessionLastSeen, id)
	return err
}
